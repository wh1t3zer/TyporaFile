# CSRF漏洞（客户端跨站请求伪造）

## 解释

（1）user----------------------->访问并登陆A网站

（2）A网站通过-------------->在user处产生A的Cookie

（3）user在未登出A网站--->访问恶意B网站

（4）B网站--------------------->访问站点A，发出请求Request

（5）收到（4）的请求，user浏览器带着Cookie---->访问A网站

（6）A网站不知道该请求是user发出的还是真正的B发出，都会根据收到的Cookie根据用户的权限处理（5）的请求

## 防御方案

1、当用户发送重要的请求时需要输入原始密码

2、设置随机Token

3、检验Referer来源，请求时判断请求链接是否为当前管理员正在使用的页面（管理员在编辑文章，黑客发来恶意的修改密码链接，因为修改密码页面管理员并没有在操作，所以攻击失败）

4、设置验证码

5、限制请求方式只能为POST

# SSRF（服务端请求伪造）

## 解释

攻击者--->绕过防火墙（可能有防火墙）--->利用存在SSRF的服务器--->获取内网主机/服务器的资产等敏感信息，甚至进行内网渗透

## 目标

从外网无法访问内部系统

## 攻击方式

1、端口扫描

2、指纹识别

3、漏洞利用

4、内网探针

## 各个协议调用探针

http、https、gopher、tftp、ftp、file、pop3、smtp、telnet等

## 漏洞原因

由于服务端提供了从其他服务器应用获取数据的功能且没有对目标地址做过滤和限制

## 利用原理

利用存在缺陷的web应用作为代理攻击远程和本地的服务器

## 挖掘

### 1、从WEB功能上寻找

1、分享：通过URL地址分享网页内容

2、转码服务：通过URL地址把原地址的网页内容调优使其适合手机屏幕浏览

3、在线翻译：通过URL地址翻译对应文本的内容。提供此功能的国内公司有百度，有道等

4、图片加载与下载：通过URL地址加载或下载图片（文件远程上传）

5、图片、文章收藏功能

6、未公开的api实现以及其他调用URL的功能

7、邮件系统

### 2、从URL关键字中寻找

share、wap、link、target、src、source、u、3g、display、sourceURL、imageURL、domain

## 验证

### 1、基本判断（排除法）

1、burp抓包

2、右键打开图片

## 绕过

### 1、IP地址转换成进制

### 2、http://example.com@127.0.0.1

### 3、利用短地址

### 4、利用特殊域名（DNS解析）

### 5、Enclosed alphanumerics（封闭式字母和数字）

### 6、利用协议

### 7、利用句号

